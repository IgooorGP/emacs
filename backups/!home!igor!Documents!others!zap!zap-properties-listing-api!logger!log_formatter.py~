"""
Module which sets the logging configuration of the root logger used by the application.
"""

import logging
import sys

import flask
from flask import request


class LogFormatter(logging.Formatter):
    """
    This class formats each log record before sending it to the
    output stream. It uses flask's request id.
    """

    # runs to format the log
    def format(self, record):

        if flask.has_request_context():
            # adds request_id to the record based on X-REQUEST-ID that comes from the requests
            record.request_id = request.headers.get("X-REQUEST-ID", "nothing")

        else:
            record.request_id = "no_request_context"

        return super(LogFormatter, self).format(record)


handler = logging.StreamHandler(sys.stdout)

# sets the logging format
handler.setFormatter(
    LogFormatter("%(asctime)s - %(name)s - level=%(levelname)s - request_id=%(request_id)s - %(message)s")
)

# adds the formatter handler
logging.getLogger().setLevel(logging.INFO)
logging.getLogger().addHandler(handler)
